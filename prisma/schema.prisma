// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  // output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model User {
  id String @id @default(cuid())

  username     String @unique
  passwordHash String @db.Text
  isAdmin      Boolean @default(false)

  accounts Account[]
  sessions Session[]
}

// prisma/schema.prisma
model Cutting {
  id             String   @id @default(cuid())

  /// Operation date (stored as DATE, no time)
  operationDate  DateTime @db.Date

  /// Dropdown selection in your UI
  panelId        String   // e.g., "Heavy Duty Fabric", "Type 148"

  panelType      String?

  /// Measurement fields (allow decimals)
  constructionA   Float
  constructionB   Float  // Tape/Inch
  meterage         Float
  weight         Float     // g/mÂ²
  widthSize      Float     // inch
  lengthSize     Float     // inch

  /// Pcs (integer only)
  actualOutput   Int

  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  // Helpful for date-range queries
  @@index([operationDate])
}



model Sewing {
  id            String   @id @default(cuid())
  operationDate DateTime @default(now())
  operationType String    // e.g., "SP1", ...

  C1  Int?  @map("C1")   
  C2  Int?  @map("C2")   
  C3  Int?  @map("C3")   
  C4  Int?  @map("C4")
  C5  Int?  @map("C5")   
  C6  Int?  @map("C6")   
  C7  Int?  @map("C7")   
  C8  Int?  @map("C8")
  C9  Int?  @map("C9")   
  C10 Int?  @map("C10")  
  C11 Int?  @map("C11")  
  C12 Int?  @map("C12")
  S1  Int?  @map("S1")   
  S2  Int?  @map("S2")   
  S3  Int?  @map("S3")   
  S4  Int?  @map("S4")
  S5  Int?  @map("S5")   
  S6  Int?  @map("S6")   
  S7  Int?  @map("S7")   
  S8  Int?  @map("S8")
  S9  Int?  @map("S9")   
  S10 Int?  @map("S10")  
  S11 Int?  @map("S11")  
  S12 Int?  @map("S12")
  S13 Int?  @map("S13")  
  S14 Int?  @map("S14")  
  S15 Int?  @map("S15")  
  S16 Int?  @map("S16")
  S17 Int?  @map("S17")  
  S18 Int?  @map("S18")  
  S19 Int?  @map("S19")  
  S20 Int?  @map("S20")
  S21 Int?  @map("S21")  
  S22 Int?  @map("S22")  
  S23 Int?  @map("S23")  
  S24 Int?  @map("S24")
  ST1 Int?  @map("ST1")  
  ST2 Int?  @map("ST2")

  updatedAt     DateTime @updatedAt

  @@index([operationDate])
  // One row per day per operation type (e.g., SP1, SP2...)
  @@unique([operationDate, operationType])
}



model Inspection {
  id            String   @id @default(cuid())
  operationDate DateTime @default(now())
  operationType String // eg., "IH", "S", "OS", "B"
  I1            Int?
  I2            Int?
  I3            Int?
  I4            Int?
  I5            Int?
  I6            Int?
  I7            Int?
  I8            Int?
  I9            Int?
  I10           Int?
  I11           Int?
  I12           Int?
  I13           Int?
  I14           Int?

  yearMonth String @db.VarChar(7)

  updatedAt DateTime @updatedAt

  @@index([operationDate])
  @@index([operationType])
  @@index([yearMonth])

  @@unique([operationDate, operationType])
}



model Packing {
  id                       String   @id @default(cuid())
  operationDate            DateTime @default(now())
  M1ForInHouse             Int?
  M1ForSemi                Int?
  M1ForCompleteWt100       Int?
  M1ForCompleteWO100       Int?
  M2ForInHouse             Int?
  M2ForSemi                Int?
  M2ForCompleteWt100       Int?
  M2ForCompleteWO100       Int?
  updatedAt                DateTime @updatedAt

  @@index([operationDate])
  @@unique([operationDate])
}



model OperationTime {
  id          String   @id @default(cuid())
  SectionType String    
  OperatorId  Int
  yearMonth   String    // "YYYY-MM"

  D1  Int?  @map("D1")   
  D2  Int?  @map("D2")   
  D3  Int?  @map("D3")   
  D4  Int?  @map("D4")
  D5  Int?  @map("D5")   
  D6  Int?  @map("D6")   
  D7  Int?  @map("D7")   
  D8  Int?  @map("D8")
  D9  Int?  @map("D9")   
  D10 Int?  @map("D10")  
  D11 Int?  @map("D11")  
  D12 Int?  @map("D12")
  D13 Int?  @map("D13")  
  D14 Int?  @map("D14")  
  D15 Int?  @map("D15")  
  D16 Int?  @map("D16")
  D17 Int?  @map("D17")  
  D18 Int?  @map("D18")  
  D19 Int?  @map("D19")  
  D20 Int?  @map("D20")
  D21 Int?  @map("D21")  
  D22 Int?  @map("D22")  
  D23 Int?  @map("D23")  
  D24 Int?  @map("D24")
  D25 Int?  @map("D25")  
  D26 Int?  @map("D26")  
  D27 Int?  @map("D27")  
  D28 Int?  @map("D28")
  D29 Int?  @map("D29")  
  D30 Int?  @map("D30")  
  D31 Int?  @map("D31")

  updatedAt   DateTime @updatedAt

  // One row per (section, operator, month)
  @@unique([SectionType, OperatorId, yearMonth])

  @@index([yearMonth])
  @@index([SectionType, yearMonth])
}


// enums
enum ProcessType {
  SEWING
  INSPECTION_100
}


model EfficiencySewing {
  id                        String   @id @default(cuid())
  operationDate             DateTime @default(now())
  processType               ProcessType @default(SEWING)

  // Targets
  m1_target_panel           Int?     // M1

  // Normal time
  m2_workers_normal         Int?     // M2
  m3_operating_mins_normal  Decimal? @db.Decimal(10,2) // M3

  // Overtime
  m4_workers_ot             Int?     // M4
  m5_operating_mins_ot      Decimal? @db.Decimal(10,2) // M5

  createdAt                 DateTime @default(now())
  updatedAt                 DateTime @updatedAt

  @@index([operationDate])
}

model EfficiencyInspection100 {
  id                        String   @id @default(cuid())
  operationDate             DateTime @default(now())
  processType               ProcessType @default(INSPECTION_100)

  m1_target_panel           Int?     // M1
  m6_target_duffel          Int?     // M6
  m7_target_blower          Int?     // M7

  // Normal time
  m2_workers_normal         Int?     // M2
  m3_operating_mins_normal  Decimal? @db.Decimal(10,2) // M3

  // Overtime
  m4_workers_ot             Int?     // M4
  m5_operating_mins_ot      Decimal? @db.Decimal(10,2) // M5

  createdAt                 DateTime @default(now())
  updatedAt                 DateTime @updatedAt

  @@index([operationDate])
}

